<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeaseBot AI Empire - Ultimate Rental Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .bg-empire {
            background: linear-gradient(135deg, #1e3a8a 0%, #0f172a 25%, #1e293b 50%, #0f172a 75%, #1e3a8a 100%);
        }
        
        .text-gold { color: #fbbf24; }
        .bg-gold { background-color: #fbbf24; }
        .border-gold { border-color: #fbbf24; }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .featured-glow {
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.3);
            border: 2px solid #fbbf24;
        }
        
        .hot-deal {
            animation: pulse 2s infinite;
        }
        
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-sans { font-family: 'Inter', sans-serif; }
        
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .voice-pulse {
            animation: voice-pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes voice-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
</head>
<body class="min-h-screen bg-empire text-white font-sans">

<!-- Navigation -->
    <nav class="bg-black/30 backdrop-blur-sm border-b border-gold/30 sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-yellow-500 to-amber-600 rounded-full flex items-center justify-center font-bold text-xl font-serif shadow-lg">
                        ⚜️
                    </div>
                    <h1 class="text-2xl font-bold font-serif text-gold">LeaseBot AI Empire</h1>
                </div>
                
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#home" class="hover:text-gold transition-colors">Home</a>
                    <a href="#about" class="hover:text-gold transition-colors">About</a>
                    <a href="#cities" class="hover:text-gold transition-colors">Cities</a>
                    <a href="#contact" class="hover:text-gold transition-colors">Contact</a>
                    <a href="#add-property" class="hover:text-gold transition-colors">Add Your Property</a>
                </div>
                
                <div class="flex items-center space-x-3">
                    <div id="authButtons" class="flex items-center space-x-3">
                        <div class="relative">
                            <button id="signUpBtn" class="flex items-center space-x-2 px-4 py-2 bg-gold text-slate-900 font-semibold rounded-lg hover:bg-yellow-400 transition-colors">
                                <i data-lucide="user-plus" class="w-4 h-4"></i>
                                <span>Sign Up</span>
                                <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            </button>
                            <div id="signUpDropdown" class="absolute right-0 mt-2 w-48 bg-slate-900 rounded-lg shadow-xl border border-gold/30 hidden z-50">
                                <a href="#" onclick="showSignUp('landlord')" class="block px-4 py-3 hover:bg-slate-800 rounded-t-lg">🏠 Landlord</a>
                                <a href="#" onclick="showSignUp('tenant')" class="block px-4 py-3 hover:bg-slate-800 rounded-b-lg">🏡 Tenant</a>
                            </div>
                        </div>
                        <button id="loginBtn" onclick="showLogin()" class="flex items-center space-x-2 px-4 py-2 border border-gold text-gold rounded-lg hover:bg-gold hover:text-slate-900 transition-colors">
                            <i data-lucide="log-in" class="w-4 h-4"></i>
                            <span>Log In</span>
                        </button>
                    </div>
                    
                    <div id="userMenu" class="hidden flex items-center space-x-3">
                        <span id="userName" class="text-gold"></span>
                        <button id="dashboardBtn" class="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">Dashboard</button>
                        <button id="logoutBtn" onclick="logout()" class="px-4 py-2 border border-red-500 text-red-500 rounded-lg hover:bg-red-500 hover:text-white transition-colors">Logout</button>
                    </div>
                    
                    <button id="chatBtn" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                        <span>AI Assistant</span>
                    </button>
                    
                    <button class="md:hidden text-gold">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="py-20 text-center relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-blue-900/20 via-transparent to-amber-900/20"></div>
        <div class="container mx-auto px-4 relative z-10">
            <h2 class="text-6xl font-bold mb-6 font-serif text-gold">
                The Digital Real Estate Empire
            </h2>
            <p class="text-xl text-cream-200 mb-8 max-w-3xl mx-auto">
                Discover extraordinary rentals across all 50 states. From NYC penthouses to LA lofts, Miami beaches to Seattle skylines — your dream home awaits in our empire.
            </p>
            
            <!-- Enhanced Search with Voice -->
            <div class="max-w-5xl mx-auto mb-8">
                <div class="bg-black/20 backdrop-blur-sm border border-gold/30 rounded-2xl p-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-3 w-5 h-5 text-gold"></i>
                            <input
                                type="text"
                                id="searchInput"
                                placeholder="2BR under $2,000 in LA... (or click mic)"
                                class="w-full pl-10 pr-12 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold text-white placeholder-gray-400"
                            />
                            <button id="voiceBtn" class="absolute right-3 top-3 text-gold hover:text-yellow-300 transition-colors">
                                <i data-lucide="mic" class="w-5 h-5"></i>
                            </button>
                        </div>
                        
                        <div class="relative">
                            <i data-lucide="map-pin" class="absolute left-3 top-3 w-5 h-5 text-gold"></i>
                            <select id="stateFilter" class="w-full pl-10 pr-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold text-white">
                                <option value="">All States</option>
                                <option value="CA">🌴 California</option>
                                <option value="TX">🤠 Texas</option>
                                <option value="FL">🏖️ Florida</option>
                                <option value="NY">🗽 New York</option>
                                <option value="WA">🌲 Washington</option>
                                <option value="CO">🏔️ Colorado</option>
                                <option value="IL">🏙️ Illinois</option>
                                <option value="PA">🔔 Pennsylvania</option>
                                <option value="OH">🌾 Ohio</option>
                                <option value="GA">🍑 Georgia</option>
                            </select>
                        </div>
                        
                        <div class="relative">
                            <i data-lucide="bed" class="absolute left-3 top-3 w-5 h-5 text-gold"></i>
                            <select id="bedroomFilter" class="w-full pl-10 pr-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold text-white">
                                <option value="">Any Bedrooms</option>
                                <option value="Studio">🏠 Studio</option>
                                <option value="1 BR">🛏️ 1 Bedroom</option>
                                <option value="2 BR">🛏️🛏️ 2 Bedrooms</option>
                                <option value="3 BR">🛏️🛏️🛏️ 3 Bedrooms</option>
                                <option value="4 BR">🏰 4+ Bedrooms</option>
                            </select>
                        </div>
                        
                        <div class="relative">
                            <i data-lucide="dollar-sign" class="absolute left-3 top-3 w-5 h-5 text-gold"></i>
                            <select id="priceFilter" class="w-full pl-10 pr-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold text-white">
                                <option value="">Any Price</option>
                                <option value="0-1000">Under $1,000</option>
                                <option value="1000-1500">$1,000 - $1,500</option>
                                <option value="1500-2000">$1,500 - $2,000</option>
                                <option value="2000-2500">$2,000 - $2,500</option>
                                <option value="2500-3000">$2,500 - $3,000</option>
                                <option value="3000-999999">$3,000+</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 justify-center">
                        <button onclick="filterByState('CA')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-colors">🌴 California</button>
                        <button onclick="filterByState('TX')" class="px-4 py-2 bg-red-600/20 hover:bg-red-600/40 rounded-lg transition-colors">🤠 Texas</button>
                        <button onclick="filterByState('FL')" class="px-4 py-2 bg-orange-600/20 hover:bg-orange-600/40 rounded-lg transition-colors">🏖️ Florida</button>
                        <button onclick="filterByState('NY')" class="px-4 py-2 bg-purple-600/20 hover:bg-purple-600/40 rounded-lg transition-colors">🗽 New York</button>
                        <button onclick="filterByState('WA')" class="px-4 py-2 bg-green-600/20 hover:bg-green-600/40 rounded-lg transition-colors">🌲 Washington</button>
                        <button onclick="resetFilters()" class="px-4 py-2 bg-gold/20 hover:bg-gold/40 rounded-lg transition-colors">🔄 Reset</button>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center items-center space-x-4 mb-8">
                <div class="text-sm text-gray-300">
                    <span id="listingCount">0</span> empire properties nationwide
                </div>
                <button onclick="toggleMapView()" class="flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                    <i data-lucide="map" class="w-4 h-4"></i>
                    <span>Map View</span>
                </button>
            </div>
        </div>
    </section>

    <!-- Featured Carousel -->
    <section class="py-12">
        <div class="container mx-auto px-4">
            <h3 class="text-3xl font-bold font-serif text-center mb-8 text-gold">🔥 Featured Properties</h3>
            <div id="featuredCarousel" class="flex space-x-6 overflow-x-auto pb-4">
                <!-- Featured listings will be populated here -->
            </div>
        </div>
    </section>
<!-- Sorting Controls -->
    <section class="py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap items-center justify-between mb-8 gap-4">
                <h3 class="text-3xl font-bold font-serif">Empire Properties</h3>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-300">Showing <span id="displayCount">0</span> properties</span>
                    <select id="sortBy" class="px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                        <option value="newest">Newest First</option>
                        <option value="price-low">Price: Low → High</option>
                        <option value="price-high">Price: High → Low</option>
                        <option value="features">Best Features</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Map View -->
    <div id="mapView" class="hidden py-12">
        <div class="container mx-auto px-4">
            <div class="bg-black/20 backdrop-blur-sm border border-gold/30 rounded-2xl p-6 h-96 flex items-center justify-center">
                <div class="text-center">
                    <i data-lucide="map-pin" class="w-16 h-16 text-gold mx-auto mb-4"></i>
                    <h4 class="text-xl font-semibold mb-2">Interactive Map Coming Soon</h4>
                    <p class="text-gray-400">Map integration with Google Maps/Mapbox will show property locations</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Listings Grid -->
    <section class="py-12">
        <div class="container mx-auto px-4">
            <div id="loadingSpinner" class="text-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-gold mx-auto"></div>
                <p class="mt-4 text-gray-300">Loading empire properties...</p>
            </div>
            
            <div id="listingsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
                <!-- Listings will be populated here -->
            </div>
            
            <div id="noResults" class="text-center py-12 hidden">
                <i data-lucide="search-x" class="w-16 h-16 text-gold mx-auto mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">No properties found in the empire</h3>
                <p class="text-gray-400 mb-4">Try expanding your search filters or exploring different regions.</p>
                <button onclick="resetFilters()" class="px-6 py-3 bg-gold text-slate-900 font-semibold rounded-lg hover:bg-yellow-400 transition-colors">
                    Reset Filters
                </button>
            </div>
            
            <div class="text-center mt-8">
                <button id="loadMoreBtn" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors hidden">
                    Load More Empire Properties
                </button>
            </div>
        </div>
    </section>

    <!-- Property Modal -->
    <div id="propertyModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-slate-900 rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto border border-gold/30">
            <div id="modalContent">
                <!-- Modal content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-slate-900 rounded-2xl max-w-md w-full border border-gold/30">
            <div id="authContent">
                <!-- Auth forms will be populated here -->
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden py-12">
        <div class="container mx-auto px-4">
            <div id="dashboardContent">
                <!-- Dashboard content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Chat Widget -->
    <div id="chatWidget" class="fixed bottom-4 right-4 w-96 h-[500px] bg-black/90 backdrop-blur-sm rounded-2xl flex-col hidden border border-gold/30 shadow-2xl">
        <div class="flex items-center justify-between p-4 border-b border-gold/30">
            <div class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-gold rounded-full flex items-center justify-center text-slate-900 font-bold">
                    🤖
                </div>
                <h4 class="font-semibold text-gold font-serif">LeaseBot AI Assistant</h4>
            </div>
            <button id="closeChatBtn" class="text-gray-400 hover:text-white text-xl">&times;</button>
        </div>
        
        <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3">
            <div class="flex justify-start">
                <div class="max-w-xs px-4 py-3 rounded-lg bg-gold/20 text-cream-100 border border-gold/30">
                    🏰 Welcome to LeaseBot AI Empire! I can help you find properties using natural language. Try: "2BR under $2000 in LA" or "Pet-friendly places with pool in Miami"
                </div>
            </div>
        </div>
        
        <div class="p-4 border-t border-gold/30">
            <div class="flex space-x-2">
                <input
                    type="text"
                    id="chatInput"
                    placeholder="Try: 'Studio in Seattle' or 'Reset filters'"
                    class="flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold text-white placeholder-gray-400"
                />
                <button id="sendChatBtn" class="px-4 py-2 bg-gold text-slate-900 font-semibold rounded-lg hover:bg-yellow-400 transition-colors">
                    Send
                </button>
            </div>
        </div>
    </div>
<!-- Footer -->
    <footer class="bg-black/30 backdrop-blur-sm border-t border-gold/30 py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="font-semibold mb-4 text-gold font-serif">🏴‍☠️ Empire States</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" onclick="filterByState('CA')" class="hover:text-gold transition-colors">🌴 California</a></li>
                        <li><a href="#" onclick="filterByState('TX')" class="hover:text-gold transition-colors">🤠 Texas</a></li>
                        <li><a href="#" onclick="filterByState('FL')" class="hover:text-gold transition-colors">🏖️ Florida</a></li>
                        <li><a href="#" onclick="filterByState('NY')" class="hover:text-gold transition-colors">🗽 New York</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4 text-gold font-serif">⚓ Major Cities</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" onclick="searchCity('Los Angeles')" class="hover:text-gold transition-colors">Los Angeles</a></li>
                        <li><a href="#" onclick="searchCity('New York')" class="hover:text-gold transition-colors">New York</a></li>
                        <li><a href="#" onclick="searchCity('Chicago')" class="hover:text-gold transition-colors">Chicago</a></li>
                        <li><a href="#" onclick="searchCity('Houston')" class="hover:text-gold transition-colors">Houston</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4 text-gold font-serif">🗺️ Empire Features</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li>🌍 Nationwide Coverage</li>
                        <li>⚡ Real-time Updates</li>
                        <li>🤖 AI-Powered Search</li>
                        <li>💬 Smart Assistant</li>
                        <li>🏰 Premium Properties</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4 text-gold font-serif">📞 Contact Empire</h4>
                    <div class="text-sm text-gray-400 space-y-2">
                        <p>🏴‍☠️ 110+ cities across 50 states</p>
                        <p>⚡ Updated hourly with fresh listings</p>
                        <p>📧 empire@leasebotai.com</p>
                        <div class="mt-4">
                            <a href="#" class="text-gold hover:text-yellow-400">Terms of Service</a> | 
                            <a href="#" class="text-gold hover:text-yellow-400">Privacy Policy</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p class="font-serif">© 2025 LeaseBot AI Empire. <span class="text-gold">Conquering real estate, one property at a time.</span> 🏴‍☠️</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let allListings = [];
        let filteredListings = [];
        let displayedListings = [];
        let currentPage = 0;
        let currentUser = null;
        let savedListings = new Set();
        let recognition = null;
        let mapView = false;
        const itemsPerPage = 12;

        // Initialize the empire
        document.addEventListener('DOMContentLoaded', function() {
            loadListings();
            setupEventListeners();
            initializeAuth();
            setupVoiceRecognition();
            setTimeout(() => {
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }, 100);
        });

        // Setup voice recognition
        function setupVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('searchInput').value = transcript;
                    filterListings();
                    
                    // Open chat and show voice input
                    document.getElementById('chatWidget').classList.remove('hidden');
                    document.getElementById('chatWidget').classList.add('flex');
                    addChatMessage('user', `🎤 Voice: "${transcript}"`);
                    setTimeout(() => {
                        const response = generateEmpireResponse(transcript);
                        addChatMessage('bot', response);
                    }, 1000);
                };

                recognition.onerror = function(event) {
                    console.log('Voice recognition error:', event.error);
                    showNotification('Voice recognition not available', 'error');
                };

                document.getElementById('voiceBtn').addEventListener('click', function() {
                    if (recognition) {
                        this.classList.add('voice-pulse');
                        this.innerHTML = '<i data-lucide="mic-off" class="w-5 h-5"></i>';
                        recognition.start();
                        setTimeout(() => {
                            this.classList.remove('voice-pulse');
                            this.innerHTML = '<i data-lucide="mic" class="w-5 h-5"></i>';
                            if (typeof lucide !== 'undefined') lucide.createIcons();
                        }, 3000);
                    }
                });
            } else {
                document.getElementById('voiceBtn').style.display = 'none';
            }
        }

        // Initialize authentication
        function initializeAuth() {
            const savedUser = localStorage.getItem('currentUser');
            const savedListingsArray = localStorage.getItem('savedListings');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateAuthUI();
            }
            
            if (savedListingsArray) {
                savedListings = new Set(JSON.parse(savedListingsArray));
            }
        }

        // Generate comprehensive empire listings with dynamic imagery
        function generateEmpireListings() {
            const cities = [
                // California Empire
                { city: 'Los Angeles', state: 'CA', avg_price: 2800, count: 12, image_search: 'modern apartment los angeles skyline' },
                { city: 'San Francisco', state: 'CA', avg_price: 3200, count: 10, image_search: 'luxury apartment san francisco bay' },
                { city: 'San Diego', state: 'CA', avg_price: 2400, count: 8, image_search: 'beachfront apartment san diego' },
                { city: 'Oakland', state: 'CA', avg_price: 2900, count: 6, image_search: 'urban loft oakland' },
                
                // Texas Empire
                { city: 'Houston', state: 'TX', avg_price: 1600, count: 10, image_search: 'modern apartment houston downtown' },
                { city: 'Dallas', state: 'TX', avg_price: 1800, count: 9, image_search: 'luxury condo dallas skyline' },
                { city: 'Austin', state: 'TX', avg_price: 2200, count: 8, image_search: 'trendy apartment austin downtown' },
                { city: 'San Antonio', state: 'TX', avg_price: 1400, count: 6, image_search: 'apartment san antonio riverwalk' },
                
                // Florida Empire
                { city: 'Miami', state: 'FL', avg_price: 2600, count: 10, image_search: 'luxury condo miami beach ocean view' },
                { city: 'Orlando', state: 'FL', avg_price: 1900, count: 7, image_search: 'family apartment orlando' },
                { city: 'Tampa', state: 'FL', avg_price: 2100, count: 8, image_search: 'waterfront apartment tampa bay' },
                
                // New York Empire
                { city: 'New York', state: 'NY', avg_price: 3500, count: 15, image_search: 'luxury apartment manhattan high rise' },
                { city: 'Buffalo', state: 'NY', avg_price: 1200, count: 5, image_search: 'apartment buffalo downtown' },
                
                // Washington Empire
                { city: 'Seattle', state: 'WA', avg_price: 2800, count: 10, image_search: 'seattle apartment space needle view' },
                { city: 'Spokane', state: 'WA', avg_price: 1600, count: 4, image_search: 'apartment spokane' },
                
                // Colorado Empire
                { city: 'Denver', state: 'CO', avg_price: 2400, count: 8, image_search: 'denver apartment mountain view' },
                { city: 'Colorado Springs', state: 'CO', avg_price: 1900, count: 5, image_search: 'colorado springs apartment' },
                
                // Additional Empire Cities
                { city: 'Chicago', state: 'IL', avg_price: 2300, count: 12, image_search: 'chicago apartment skyline river' },
                { city: 'Philadelphia', state: 'PA', avg_price: 1900, count: 9, image_search: 'philadelphia apartment historic' },
                { city: 'Atlanta', state: 'GA', avg_price: 1800, count: 9, image_search: 'atlanta modern apartment midtown' },
                { city: 'Columbus', state: 'OH', avg_price: 1500, count: 6, image_search: 'columbus apartment downtown' }
            ];
            
            const descriptions = [
                'Luxury penthouse with stunning city views and premium amenities including rooftop pool and concierge services',
                'Modern smart apartment with automated systems, in-unit laundry, and covered parking in prime location',
                'Historic charming property with original hardwood floors, exposed brick, and contemporary updates throughout',
                'Brand new construction with floor-to-ceiling windows, granite countertops, and state-of-the-art fitness center',
                'Pet-friendly oasis with dog park, grooming station, and spacious balconies overlooking manicured gardens',
                'Walking distance to public transit, shopping district, and renowned restaurants and entertainment venues',
                'Bright corner unit with panoramic views, walk-in closets, and resort-style pool and spa facilities',
                'Gated luxury community with 24/7 security, valet parking, and exclusive resident amenities',
                'Industrial loft-style with exposed brick, soaring high ceilings, and designer finishes throughout',
                'Garden-level sanctuary with private patio, storage unit, and access to community gardens',
                'Penthouse living with rooftop terrace, panoramic city views, and premium appliance package',
                'Cozy studio perfect for young professionals with murphy bed and efficient smart design',
                'Family-friendly community with playground, picnic areas, and access to top-rated school districts',
                'Downtown urban living with easy access to entertainment, dining, and cultural attractions',
                'Waterfront paradise with marina access, infinity pool, and breathtaking sunset views'
            ];
            
            const amenityGroups = [
                'pool, fitness center, concierge',
                'in-unit laundry, parking, storage',
                'pet-friendly, dog park, grooming',
                'balcony, patio, city views',
                'hardwood floors, granite counters',
                'smart home, high-speed internet',
                'rooftop access, outdoor grilling',
                'security, gated community',
                'dishwasher, stainless appliances',
                'fireplace, walk-in closets'
            ];
            
            const listings = [];
            let id = 1;
            
            cities.forEach(cityData => {
                for (let i = 0; i < cityData.count; i++) {
                    const bedroomOptions = ['Studio', '1 BR', '2 BR', '3 BR', '4 BR'];
                    const bedrooms = bedroomOptions[Math.floor(Math.random() * bedroomOptions.length)];
                    
                    // Enhanced price variation
                    let priceMultiplier = 1;
                    if (bedrooms === 'Studio') priceMultiplier = 0.65;
                    else if (bedrooms === '1 BR') priceMultiplier = 0.85;
                    else if (bedrooms === '2 BR') priceMultiplier = 1.25;
                    else if (bedrooms === '3 BR') priceMultiplier = 1.65;
                    else if (bedrooms === '4 BR') priceMultiplier = 2.1;
                    
                    const priceVariation = (Math.random() - 0.5) * 0.4;
                    const price = Math.round(cityData.avg_price * priceMultiplier * (1 + priceVariation));
                    
                    const description = descriptions[Math.floor(Math.random() * descriptions.length)];
                    const amenities = amenityGroups[Math.floor(Math.random() * amenityGroups.length)];
                    
                    // Determine property status
                    const isFeatured = Math.random() < 0.15; // 15% chance
                    const isHot = Math.random() < 0.1; // 10% chance
                    const daysListed = Math.floor(Math.random() * 30) + 1;
                    
                    // Generate dynamic Unsplash image URLs
                    const baseImageQuery = `${cityData.image_search} ${bedrooms.toLowerCase()} interior modern`;
                    const imageUrl = `https://source.unsplash.com/800x600/?${encodeURIComponent(baseImageQuery)}`;
                    
                    listings.push({
                        id: id++,
                        city: cityData.city,
                        state: cityData.state,
                        price: `$${price.toLocaleString()}/mo`,
                        priceValue: price,
                        bedrooms: bedrooms,
                        bathrooms: bedrooms === 'Studio' ? '1' : Math.ceil(Math.random() * 3).toString(),
                        sqft: bedrooms === 'Studio' ? 500 + Math.floor(Math.random() * 300) : 
                              bedrooms === '1 BR' ? 700 + Math.floor(Math.random() * 400) :
                              bedrooms === '2 BR' ? 1000 + Math.floor(Math.random() * 500) :
                              bedrooms === '3 BR' ? 1400 + Math.floor(Math.random() * 600) :
                              1800 + Math.floor(Math.random() * 800),
                        description: description,
                        amenities: amenities,
                        isFeatured: isFeatured,
                        isHot: isHot,
                        daysListed: daysListed,
                        image: imageUrl,
                        images: [
                            imageUrl,
                            `https://source.unsplash.com/800x600/?${encodeURIComponent(baseImageQuery + ' kitchen')}`,
                            `https://source.unsplash.com/800x600/?${encodeURIComponent(baseImageQuery + ' bathroom')}`,
                            `https://source.unsplash.com/800x600/?${encodeURIComponent(baseImageQuery + ' bedroom')}`
                        ],
                        source: 'empire'
                    });
                }
            });
            
            console.log(`🏴‍☠️ Generated ${listings.length} empire properties across the realm`);
            return listings;
        }

        // Load listings
        function loadListings() {
            setTimeout(() => {
                allListings = generateEmpireListings();
                filteredListings = [...allListings];
                updateListingCount();
                renderFeaturedCarousel();
                renderListings();
                document.getElementById('loadingSpinner').classList.add('hidden');
            }, 1500);
        }
// Setup event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', debounce(filterListings, 300));
            document.getElementById('stateFilter').addEventListener('change', filterListings);
            document.getElementById('bedroomFilter').addEventListener('change', filterListings);
            document.getElementById('priceFilter').addEventListener('change', filterListings);
            document.getElementById('sortBy').addEventListener('change', sortListings);
            document.getElementById('loadMoreBtn').addEventListener('click', loadMoreListings);
            
            // Sign up dropdown
            document.getElementById('signUpBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('signUpDropdown').classList.toggle('hidden');
            });
            
            document.addEventListener('click', () => {
                document.getElementById('signUpDropdown').classList.add('hidden');
            });
            
            // Chat functionality
            document.getElementById('chatBtn').addEventListener('click', () => {
                document.getElementById('chatWidget').classList.remove('hidden');
                document.getElementById('chatWidget').classList.add('flex');
            });
            
            document.getElementById('closeChatBtn').addEventListener('click', () => {
                document.getElementById('chatWidget').classList.add('hidden');
                document.getElementById('chatWidget').classList.remove('flex');
            });
            
            document.getElementById('sendChatBtn').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
        }

        // Enhanced filtering with natural language processing
        function filterListings() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const stateFilter = document.getElementById('stateFilter').value;
            const bedroomFilter = document.getElementById('bedroomFilter').value;
            const priceFilter = document.getElementById('priceFilter').value;
            
            filteredListings = allListings.filter(listing => {
                const matchesSearch = !searchTerm || 
                    listing.city.toLowerCase().includes(searchTerm) ||
                    listing.state.toLowerCase().includes(searchTerm) ||
                    listing.description.toLowerCase().includes(searchTerm) ||
                    listing.amenities.toLowerCase().includes(searchTerm) ||
                    listing.bedrooms.toLowerCase().includes(searchTerm);
                
                const matchesState = !stateFilter || listing.state === stateFilter;
                const matchesBedrooms = !bedroomFilter || listing.bedrooms === bedroomFilter;
                
                let matchesPrice = true;
                if (priceFilter) {
                    const [min, max] = priceFilter.split('-').map(p => parseInt(p));
                    matchesPrice = listing.priceValue >= min && listing.priceValue <= max;
                }
                
                return matchesSearch && matchesState && matchesBedrooms && matchesPrice;
            });
            
            // Parse natural language queries
            if (searchTerm) {
                parseNaturalLanguageQuery(searchTerm);
            }
            
            currentPage = 0;
            displayedListings = [];
            updateListingCount();
            renderListings();
        }

        // Parse natural language queries
        function parseNaturalLanguageQuery(query) {
            const lowerQuery = query.toLowerCase();
            
            // Extract price constraints
            if (lowerQuery.includes('under') || lowerQuery.includes('below')) {
                const priceMatch = lowerQuery.match(/under|below.*?(\d+)/);
                if (priceMatch) {
                    const maxPrice = parseInt(priceMatch[1]);
                    filteredListings = filteredListings.filter(l => l.priceValue <= maxPrice);
                }
            }
            
            if (lowerQuery.includes('over') || lowerQuery.includes('above')) {
                const priceMatch = lowerQuery.match(/over|above.*?(\d+)/);
                if (priceMatch) {
                    const minPrice = parseInt(priceMatch[1]);
                    filteredListings = filteredListings.filter(l => l.priceValue >= minPrice);
                }
            }
            
            // Extract bedroom requirements
            if (lowerQuery.includes('studio')) {
                filteredListings = filteredListings.filter(l => l.bedrooms === 'Studio');
            } else if (lowerQuery.match(/(\d+)\s*(br|bed|bedroom)/)) {
                const bedroomMatch = lowerQuery.match(/(\d+)\s*(br|bed|bedroom)/);
                if (bedroomMatch) {
                    const beds = bedroomMatch[1] + ' BR';
                    filteredListings = filteredListings.filter(l => l.bedrooms === beds);
                }
            }
            
            // Extract amenity preferences
            if (lowerQuery.includes('pet') || lowerQuery.includes('dog') || lowerQuery.includes('cat')) {
                filteredListings = filteredListings.filter(l => l.amenities.toLowerCase().includes('pet'));
            }
            
            if (lowerQuery.includes('pool')) {
                filteredListings = filteredListings.filter(l => l.amenities.toLowerCase().includes('pool'));
            }
            
            if (lowerQuery.includes('parking')) {
                filteredListings = filteredListings.filter(l => l.amenities.toLowerCase().includes('parking'));
            }
        }

        // Sort listings
        function sortListings() {
            const sortBy = document.getElementById('sortBy').value;
            
            switch (sortBy) {
                case 'price-low':
                    filteredListings.sort((a, b) => a.priceValue - b.priceValue);
                    break;
                case 'price-high':
                    filteredListings.sort((a, b) => b.priceValue - a.priceValue);
                    break;
                case 'newest':
                    filteredListings.sort((a, b) => a.daysListed - b.daysListed);
                    break;
                case 'features':
                    filteredListings.sort((a, b) => {
                        const aScore = (a.isFeatured ? 2 : 0) + (a.isHot ? 1 : 0) + a.amenities.split(',').length;
                        const bScore = (b.isFeatured ? 2 : 0) + (b.isHot ? 1 : 0) + b.amenities.split(',').length;
                        return bScore - aScore;
                    });
                    break;
            }
            
            currentPage = 0;
            displayedListings = [];
            renderListings();
        }

        // Render featured carousel
        function renderFeaturedCarousel() {
            const carousel = document.getElementById('featuredCarousel');
            const featuredListings = allListings.filter(listing => listing.isFeatured).slice(0, 8);
            
            carousel.innerHTML = '';
            featuredListings.forEach(listing => {
                const card = createFeaturedCard(listing);
                carousel.appendChild(card);
            });
        }

        // Create featured card
        function createFeaturedCard(listing) {
            const card = document.createElement('div');
            card.className = 'min-w-[300px] bg-white/10 backdrop-blur-sm border border-gold/30 rounded-lg overflow-hidden card-hover featured-glow';
            
            card.innerHTML = `
                <div class="relative aspect-video">
                    <img 
                        src="${listing.image}" 
                        alt="${listing.city} featured rental"
                        class="w-full h-full object-cover"
                        onerror="this.src='https://source.unsplash.com/800x600/?luxury-apartment-interior'"
                    />
                    <div class="absolute top-3 left-3">
                        <span class="px-2 py-1 bg-gold text-slate-900 font-bold text-xs rounded">⭐ FEATURED</span>
                    </div>
                    <div class="absolute top-3 right-3">
                        <button onclick="toggleSaved(${listing.id})" class="p-2 bg-black/50 rounded-full hover:bg-black/70 transition-colors">
                            <i data-lucide="heart" class="w-4 h-4 text-white"></i>
                        </button>
                    </div>
                </div>
                <div class="p-4">
                    <h4 class="text-lg font-semibold text-gold mb-2">${listing.city}, ${listing.state}</h4>
                    <p class="text-2xl font-bold text-green-400 mb-2">${listing.price}</p>
                    <div class="flex items-center space-x-3 text-sm text-gray-300 mb-3">
                        <span>🛏️ ${listing.bedrooms}</span>
                        <span>🛁 ${listing.bathrooms} bath</span>
                        <span>📐 ${listing.sqft.toLocaleString()} sqft</span>
                    </div>
                    <button onclick="openPropertyModal(${listing.id})" class="w-full bg-gold text-slate-900 font-semibold py-2 rounded-lg hover:bg-yellow-400 transition-colors">
                        View Details
                    </button>
                </div>
            `;
            
            return card;
        }

        // Render listings
        function renderListings() {
            const grid = document.getElementById('listingsGrid');
            const noResults = document.getElementById('noResults');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            
            if (filteredListings.length === 0) {
                grid.classList.add('hidden');
                noResults.classList.remove('hidden');
                loadMoreBtn.classList.add('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            grid.classList.remove('hidden');
            
            const startIndex = displayedListings.length;
            const endIndex = startIndex + itemsPerPage;
            const newListings = filteredListings.slice(startIndex, endIndex);
            
            displayedListings.push(...newListings);
            
            if (currentPage === 0) {
                grid.innerHTML = '';
            }
            
            newListings.forEach(listing => {
                const listingCard = createListingCard(listing);
                grid.appendChild(listingCard);
            });
            
            if (displayedListings.length < filteredListings.length) {
                loadMoreBtn.classList.remove('hidden');
            } else {
                loadMoreBtn.classList.add('hidden');
            }
            
            currentPage++;
            setTimeout(() => {
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }, 100);
        }

        // Create enhanced listing card
        function createListingCard(listing) {
            const card = document.createElement('div');
            const savedClass = savedListings.has(listing.id) ? 'text-red-500 fill-current' : 'text-white';
            card.className = `bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg overflow-hidden card-hover ${listing.isFeatured ? 'featured-glow' : ''}`;
            
            card.innerHTML = `
                <div class="relative aspect-video">
                    <img 
                        src="${listing.image}" 
                        alt="${listing.city} rental"
                        class="w-full h-full object-cover"
                        onerror="this.src='https://source.unsplash.com/800x600/?modern-apartment-interior'"
                    />
                    <div class="absolute top-3 left-3 flex space-x-2">
                        ${listing.isFeatured ? '<span class="px-2 py-1 bg-gold text-slate-900 font-bold text-xs rounded">⭐ FEATURED</span>' : ''}
                        ${listing.isHot && listing.daysListed <= 7 ? '<span class="px-2 py-1 bg-red-500 text-white font-bold text-xs rounded hot-deal">🔥 HOT</span>' : ''}
                    </div>
                    <div class="absolute top-3 right-3">
                        <button onclick="toggleSaved(${listing.id})" class="p-2 bg-black/50 rounded-full hover:bg-black/70 transition-colors">
                            <i data-lucide="heart" class="w-4 h-4 ${savedClass}"></i>
                        </button>
                    </div>
                    <div class="absolute bottom-3 left-3">
                        <span class="bg-black/70 text-white px-2 py-1 rounded text-sm flex items-center gap-1">
                            <i data-lucide="camera" class="w-4 h-4"></i>
                            ${listing.images.length}
                        </span>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-lg font-semibold text-gold">${listing.city}, ${listing.state}</h4>
                        <span class="text-2xl font-bold text-green-400">${listing.price}</span>
                    </div>
                    
                    <div class="flex items-center space-x-4 mb-3 text-gray-300">
                        <div class="flex items-center space-x-1">
                            <i data-lucide="bed" class="w-4 h-4"></i>
                            <span>${listing.bedrooms}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="bath" class="w-4 h-4"></i>
                            <span>${listing.bathrooms} bath</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="square" class="w-4 h-4"></i>
                            <span>${listing.sqft.toLocaleString()} sqft</span>
                        </div>
                    </div>
                    
                    <p class="text-gray-300 mb-4 line-clamp-3">${listing.description}</p>
                    
                    <div class="flex flex-wrap gap-1 mb-4">
                        ${listing.amenities.split(', ').slice(0, 3).map(amenity => 
                            `<span class="text-xs bg-blue-600/20 text-blue-300 px-2 py-1 rounded">${amenity.trim()}</span>`
                        ).join('')}
                        ${listing.amenities.split(', ').length > 3 ? 
                            `<span class="text-xs text-gray-400">+${listing.amenities.split(', ').length - 3} more</span>` : ''}
                    </div>
                    
                    <div class="flex space-x-2">
                        <button 
                            onclick="openPropertyModal(${listing.id})"
                            class="flex-1 bg-gold text-slate-900 font-semibold py-2 px-4 rounded-lg hover:bg-yellow-400 transition-colors"
                        >
                            View Details
                        </button>
                        <button 
                            onclick="handleInquiry(${listing.id})"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-medium"
                        >
                            Inquire
                        </button>
                        <button 
                            onclick="shareProperty(${listing.id})"
                            class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors"
                        >
                            <i data-lucide="share" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Open property modal with full details
        function openPropertyModal(listingId) {
            const listing = allListings.find(l => l.id === listingId);
            if (!listing) return;
            
            const modal = document.getElementById('propertyModal');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="relative">
                    <div class="aspect-video bg-gradient-to-br from-blue-500/20 to-purple-500/20">
                        <img 
                            src="${listing.image}" 
                            alt="${listing.city} rental"
                            class="w-full h-full object-cover"
                        />
                        <button 
                            onclick="closeModal()"
                            class="absolute top-4 right-4 bg-black/50 rounded-full p-2 text-white hover:bg-black/70"
                        >
                            <i data-lucide="x" class="w-6 h-6"></i>
                        </button>
                        <div class="absolute bottom-4 left-4 flex space-x-2">
                            ${listing.isFeatured ? '<span class="px-2 py-1 bg-gold text-slate-900 font-bold text-xs rounded">⭐ FEATURED</span>' : ''}
                            ${listing.isHot ? '<span class="px-2 py-1 bg-red-500 text-white font-bold text-xs rounded">🔥 HOT</span>' : ''}
                        </div>
                    </div>
                    
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-6">
                            <div>
                                <h2 class="text-3xl font-bold font-serif text-gold mb-2">${listing.bedrooms} in ${listing.city}, ${listing.state}</h2>
                                <p class="text-gray-400 flex items-center gap-2">
                                    <i data-lucide="map-pin" class="w-5 h-5"></i>
                                    Premium location in ${listing.city}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-4xl font-bold text-green-400">${listing.price}</p>
                                <p class="text-gray-400">Listed ${listing.daysListed} days ago</p>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-8 mb-8">
                            <div class="md:col-span-2">
                                <div class="grid grid-cols-3 gap-4 mb-6">
                                    <div class="text-center p-4 bg-gold/10 rounded-lg border border-gold/30">
                                        <i data-lucide="bed" class="w-8 h-8 mx-auto mb-2 text-gold"></i>
                                        <p class="font-semibold text-gold">${listing.bedrooms}</p>
                                        <p class="text-sm text-gray-400">Bedrooms</p>
                                    </div>
                                    <div class="text-center p-4 bg-gold/10 rounded-lg border border-gold/30">
                                        <i data-lucide="bath" class="w-8 h-8 mx-auto mb-2 text-gold"></i>
                                        <p class="font-semibold text-gold">${listing.bathrooms}</p>
                                        <p class="text-sm text-gray-400">Bathrooms</p>
                                    </div>
                                    <div class="text-center p-4 bg-gold/10 rounded-lg border border-gold/30">
                                        <i data-lucide="square" class="w-8 h-8 mx-auto mb-2 text-gold"></i>
                                        <p class="font-semibold text-gold">${listing.sqft.toLocaleString()}</p>
                                        <p class="text-sm text-gray-400">Sq Ft</p>
                                    </div>
                                </div>
                                
                                <h4 class="font-semibold mb-3 text-gold">Description</h4>
                                <p class="text-gray-300 mb-6">${listing.description}</p>
                                
                                <h4 class="font-semibold mb-3 text-gold">Premium Amenities</h4>
                                <div class="grid grid-cols-2 gap-2">
                                    ${listing.amenities.split(', ').map(amenity => `
                                        <div class="flex items-center gap-2">
                                            <span class="w-2 h-2 bg-gold rounded-full"></span>
                                            <span class="text-gray-300">${amenity.trim()}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div class="mt-6 p-4 bg-blue-600/10 rounded-lg border border-blue-600/30">
                                    <h5 class="font-semibold text-blue-300 mb-2">🏰 Empire Guarantee</h5>
                                    <p class="text-sm text-gray-300">All properties verified by LeaseBot AI Empire. Quality assured, prices transparent, no hidden fees.</p>
                                </div>
                            </div>
                            
                            <div>
                                <div class="bg-black/30 p-6 rounded-lg border border-gold/30">
                                    <h4 class="font-semibold mb-4 text-gold">Contact Empire Agent</h4>
                                    <div class="text-center mb-4">
                                        <div class="w-16 h-16 bg-gold rounded-full flex items-center justify-center mx-auto mb-3">
                                            <span class="text-slate-900 font-bold text-lg">🏴‍☠️</span>
                                        </div>
                                        <h5 class="font-semibold">Empire Agent</h5>
                                        <p class="text-sm text-gray-400">Licensed Professional</p>
                                    </div>
                                    
                                    <div class="space-y-3">
                                        <button 
                                            onclick="handleInquiry(${listing.id})"
                                            class="flex items-center justify-center gap-2 w-full bg-gold text-slate-900 font-semibold py-2 px-4 rounded-lg hover:bg-yellow-400"
                                        >
                                            <i data-lucide="phone" class="w-4 h-4"></i>
                                            Call Now
                                        </button>
                                        <button 
                                            onclick="shareProperty(${listing.id})"
                                            class="flex items-center justify-center gap-2 w-full border border-gold text-gold py-2 px-4 rounded-lg hover:bg-gold hover:text-slate-900"
                                        >
                                            <i data-lucide="share" class="w-4 h-4"></i>
                                            Share Property
                                        </button>
                                        <button 
                                            onclick="toggleSaved(${listing.id}); closeModal();"
                                            class="flex items-center justify-center gap-2 w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700"
                                        >
                                            <i data-lucide="heart" class="w-4 h-4"></i>
                                            ${savedListings.has(listing.id) ? 'Remove from Saved' : 'Save Property'}
                                        </button>
                                    </div>
                                    
                                    <div class="mt-4 pt-4 border-t border-gold/30">
                                        <p class="text-sm text-gray-400 mb-2">Empire Contact:</p>
                                        <p class="text-sm">(555) EMPIRE-1</p>
                                        <p class="text-sm text-gold">empire@leasebotai.com</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }, 100);
        }

        // Chat system
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage('user', message);
            input.value = '';

            setTimeout(() => {
                const response = generateEmpireResponse(message);
                addChatMessage('bot', response);
            }, 1000);
        }

        function addChatMessage(type, text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'}`;
            messageDiv.innerHTML = `
                <div class="max-w-xs px-4 py-3 rounded-lg ${
                    type === 'user' 
                        ? 'bg-gold text-slate-900 font-semibold' 
                        : 'bg-white/10 text-cream-100 border border-gold/30'
                }">
                    ${text}
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Enhanced AI response system
        function generateEmpireResponse(message) {
            const msg = message.toLowerCase();
            
            // Reset command
            if (msg.includes('reset') || msg.includes('clear') || msg.includes('show all')) {
                resetFilters();
                return `🏴‍☠️ Empire filters reset! Now showing all ${allListings.length} properties across our vast domain. Browse the full empire above!`;
            }
            
            // Filtering commands
            if (msg.includes('show me') || msg.includes('find') || msg.includes('search for')) {
                
                // Price filtering
                if (msg.includes('under') || msg.includes('below')) {
                    const priceMatch = msg.match(/(\d+)/);
                    if (priceMatch) {
                        const maxPrice = parseInt(priceMatch[1]);
                        document.getElementById('searchInput').value = `under ${maxPrice}`;
                        filterListings();
                        return `⚜️ Excellent! Found ${filteredListings.length} empire properties under $${maxPrice.toLocaleString()}. These treasures await above!`;
                    }
                }
                
                // State filtering
                const stateMap = {
                    'california': 'CA', 'texas': 'TX', 'florida': 'FL', 'new york': 'NY',
                    'washington': 'WA', 'colorado': 'CO', 'illinois': 'IL', 'pennsylvania': 'PA'
                };
                
                for (const [stateName, stateCode] of Object.entries(stateMap)) {
                    if (msg.includes(stateName)) {
                        filterByState(stateCode);
                        const stateListings = allListings.filter(l => l.state === stateCode);
                        return `🗺️ ${stateName.charAt(0).toUpperCase() + stateName.slice(1)} empire territory activated! Displaying ${stateListings.length} properties in this magnificent realm!`;
                    }
                }
                
                // Bedroom filtering
                if (msg.includes('studio')) {
                    document.getElementById('bedroomFilter').value = 'Studio';
                    filterListings();
                    return `🏠 Studio apartments in the empire! Found ${filteredListings.length} cozy studios perfect for urban warriors.`;
                } else if (msg.match(/(\d+)\s*(br|bed|bedroom)/)) {
                    const bedroomMatch = msg.match(/(\d+)\s*(br|bed|bedroom)/);
                    const bedrooms = bedroomMatch[1] + ' BR';
                    document.getElementById('bedroomFilter').value = bedrooms;
                    filterListings();
                    return `🛏️ ${bedrooms} empire properties ready! Found ${filteredListings.length} spacious ${bedrooms} homes for your conquest.`;
                }
                
                // Amenity filtering
                if (msg.includes('pet') || msg.includes('dog') || msg.includes('cat')) {
                    document.getElementById('searchInput').value = 'pet-friendly';
                    filterListings();
                    return `🐾 Pet-friendly empire properties! Found ${filteredListings.length} homes where your furry companions are welcome!`;
                }
                
                if (msg.includes('pool') || msg.includes('swimming')) {
                    document.getElementById('searchInput').value = 'pool';
                    filterListings();
                    return `🏊‍♂️ Pool properties in the empire! Discovered ${filteredListings.length} aquatic paradises for your leisure.`;
                }
            }
            
            // General responses
            const responses = [
                `🏰 Welcome to the LeaseBot AI Empire! I command ${allListings.length} properties across the realm. Try commands like "show me California", "find 2BR under $2000", or "pet-friendly places with pool"!`,
                `⚜️ Your empire agent at your service! I can filter by state, price, bedrooms, or amenities. Try "show me Texas", "under $1800", or "studios with parking"!`,
                `🗺️ The empire spans coast to coast! Use natural language like "2BR in Miami under $2500" or "pet-friendly places in Seattle" to find your perfect domain!`,
                `🏴‍☠️ Ahoy! I'm your digital real estate captain. Say "show me featured properties", "reset filters", or ask about any city, price, or amenity!`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Authentication system
        function showSignUp(type) {
            const modal = document.getElementById('authModal');
            const content = document.getElementById('authContent');
            
            content.innerHTML = `
                <div class="p-8">
                    <h3 class="text-2xl font-bold font-serif text-gold mb-6">Join the Empire - ${type === 'landlord' ? '🏠 Landlord' : '🏡 Tenant'}</h3>
                    <form onsubmit="handleSignUp(event, '${type}')">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Full Name</label>
                                <input name="name" type="text" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Email</label>
                                <input name="email" type="email" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Password</label>
                                <input name="password" type="password" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                            </div>
                            ${type === 'landlord' ? `
                                <div>
                                    <label class="block text-sm font-medium mb-1">Company (Optional)</label>
                                    <input name="company" type="text" class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                                </div>
                            ` : `
                                <div>
                                    <label class="block text-sm font-medium mb-1">Budget Range</label>
                                    <select name="budget" class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                                        <option value="">Select Budget</option>
                                        <option value="0-1500">Under $1,500</option>
                                        <option value="1500-2500">$1,500 - $2,500</option>
                                        <option value="2500-3500">$2,500 - $3,500</option>
                                        <option value="3500+">$3,500+</option>
                                    </select>
                                </div>
                            `}
                            <div class="flex items-center">
                                <input type="checkbox" required class="mr-2">
                                <label class="text-sm">I agree to the <a href="#" class="text-gold">Terms of Service</a> and <a href="#" class="text-gold">Privacy Policy</a></label>
                            </div>
                        </div>
                        <div class="flex space-x-3 mt-6">
                            <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-500 text-gray-300 rounded-lg hover:bg-gray-500 hover:text-white">
                                Cancel
                            </button>
                            <button type="submit" class="flex-1 px-4 py-2 bg-gold text-slate-900 font-semibold rounded-lg hover:bg-yellow-400">
                                Join Empire
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function showLogin() {
            const modal = document.getElementById('authModal');
            const content = document.getElementById('authContent');
            
            content.innerHTML = `
                <div class="p-8">
                    <h3 class="text-2xl font-bold font-serif text-gold mb-6">Welcome Back to the Empire</h3>
                    <form onsubmit="handleLogin(event)">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-1">Email</label>
                                <input name="email" type="email" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-1">Password</label>
                                <input name="password" type="password" required class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white">
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="flex items-center">
                                    <input type="checkbox" class="mr-2">
                                    <span class="text-sm">Remember me</span>
                                </label>
                                <a href="#" class="text-sm text-gold hover:text-yellow-400">Forgot password?</a>
                            </div>
                        </div>
                        <div class="flex space-x-3 mt-6">
                            <button type="button" onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-500 text-gray-300 rounded-lg hover:bg-gray-500 hover:text-white">
                                Cancel
                            </button>
                            <button type="submit" class="flex-1 px-4 py-2 bg-gold text-slate-900 font-semibold rounded-lg hover:bg-yellow-400">
                                Enter Empire
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function handleSignUp(event, type) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            currentUser = {
                name: formData.get('name'),
                email: formData.get('email'),
                type: type,
                company: formData.get('company') || '',
                budget: formData.get('budget') || '',
                id: Date.now()
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateAuthUI();
            closeModal();
            showNotification(`🏴‍☠️ Welcome to the Empire, ${currentUser.name}!`, 'success');
        }

        function handleLogin(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            currentUser = {
                name: 'Empire User',
                email: formData.get('email'),
                type: 'tenant',
                id: Date.now()
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateAuthUI();
            closeModal();
            showNotification(`🏰 Welcome back to the empire!`, 'success');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateAuthUI();
            showNotification('Logged out of the empire', 'info');
        }

        function updateAuthUI() {
            const authButtons = document.getElementById('authButtons');
            const userMenu = document.getElementById('userMenu');
            
            if (currentUser) {
                authButtons.classList.add('hidden');
                userMenu.classList.remove('hidden');
                document.getElementById('userName').textContent = currentUser.name;
            } else {
                authButtons.classList.remove('hidden');
                userMenu.classList.add('hidden');
            }
        }

        // Utility functions
        function closeModal() {
            document.getElementById('propertyModal').classList.add('hidden');
            document.getElementById('authModal').classList.add('hidden');
        }

        function toggleSaved(listingId) {
            if (savedListings.has(listingId)) {
                savedListings.delete(listingId);
                showNotification('Property removed from saved!', 'info');
            } else {
                savedListings.add(listingId);
                showNotification('Property saved!', 'success');
            }
            
            localStorage.setItem('savedListings', JSON.stringify(Array.from(savedListings)));
        }

        function shareProperty(listingId) {
            const listing = allListings.find(l => l.id === listingId);
            if (!listing) return;
            
            if (navigator.share) {
                navigator.share({
                    title: `${listing.bedrooms} in ${listing.city}, ${listing.state}`,
                    text: `Check out this amazing property: ${listing.description}`,
                    url: window.location.href
                });
            } else {
                const url = `${window.location.href}?property=${listingId}`;
                navigator.clipboard.writeText(url).then(() => {
                    showNotification('Property link copied to clipboard!', 'success');
                });
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 'bg-blue-600'
            }`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function toggleMapView() {
            mapView = !mapView;
            const mapViewElement = document.getElementById('mapView');
            const listingsSection = document.querySelector('#listingsGrid').parentElement;
            
            if (mapView) {
                mapViewElement.classList.remove('hidden');
                listingsSection.classList.add('hidden');
            } else {
                mapViewElement.classList.add('hidden');
                listingsSection.classList.remove('hidden');
            }
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('stateFilter').value = '';
            document.getElementById('bedroomFilter').value = '';
            document.getElementById('priceFilter').value = '';
            filterListings();
        }

        function filterByState(state) {
            document.getElementById('stateFilter').value = state;
            filterListings();
        }

        function searchCity(city) {
            document.getElementById('searchInput').value = city;
            filterListings();
        }

        function handleInquiry(listingId) {
            const listing = allListings.find(l => l.id === listingId);
            if (!listing) return;
            
            document.getElementById('chatWidget').classList.remove('hidden');
            document.getElementById('chatWidget').classList.add('flex');
            
            addChatMessage('user', `Interested in ${listing.bedrooms} in ${listing.city}, ${listing.state}`);
            setTimeout(() => {
                addChatMessage('bot', `🏰 Excellent choice! This ${listing.city} property is a crown jewel. ${listing.description} Would you like more details or to schedule a viewing?`);
            }, 1000);
        }

        function loadMoreListings() {
            renderListings();
        }

        function updateListingCount() {
            document.getElementById('listingCount').textContent = allListings.length.toLocaleString();
            document.getElementById('displayCount').textContent = filteredListings.length.toLocaleString();
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>
