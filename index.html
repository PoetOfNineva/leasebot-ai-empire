<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeaseBot AI Empire - Nationwide Rental Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800 text-white">
    <!-- Header -->
    <header class="bg-black/20 backdrop-blur-sm border-b border-blue-500/30">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center font-bold">
                        LB
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                        LeaseBot AI Empire
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-300">
                        <span id="listingCount">0</span> properties nationwide
                    </div>
                    <button class="flex items-center space-x-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors">
                        <i data-lucide="phone" class="w-4 h-4"></i>
                        <span>Call Us</span>
                    </button>
                    <button id="chatBtn" class="flex items-center space-x-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                        <i data-lucide="message-circle" class="w-4 h-4"></i>
                        <span>Chat</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="py-20 text-center">
        <div class="container mx-auto px-4">
            <h2 class="text-5xl font-bold mb-6 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                Nationwide Rental Search
            </h2>
            <p class="text-xl text-gray-300 mb-8 max-w-2xl mx-auto">
                Discover amazing rentals across all 50 states. From NYC to LA, Miami to Seattle - your perfect home awaits.
            </p>
            
            <!-- Enhanced Search -->
            <div class="max-w-4xl mx-auto mb-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="relative">
                        <i data-lucide="search" class="absolute left-3 top-3 w-5 h-5 text-gray-400"></i>
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Search by city, state, or description..."
                            class="w-full pl-10 pr-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400"
                        />
                    </div>
                    
                    <div class="relative">
                        <i data-lucide="map-pin" class="absolute left-3 top-3 w-5 h-5 text-gray-400"></i>
                        <select id="stateFilter" class="w-full pl-10 pr-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
                            <option value="">All States</option>
                            <option value="CA">California</option>
                            <option value="TX">Texas</option>
                            <option value="FL">Florida</option>
                            <option value="NY">New York</option>
                            <option value="IL">Illinois</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="OH">Ohio</option>
                            <option value="GA">Georgia</option>
                            <option value="NC">North Carolina</option>
                            <option value="MI">Michigan</option>
                            <option value="WA">Washington</option>
                            <option value="AZ">Arizona</option>
                            <option value="MA">Massachusetts</option>
                            <option value="TN">Tennessee</option>
                            <option value="IN">Indiana</option>
                            <option value="MO">Missouri</option>
                            <option value="MD">Maryland</option>
                            <option value="WI">Wisconsin</option>
                            <option value="CO">Colorado</option>
                            <option value="MN">Minnesota</option>
                            <option value="SC">South Carolina</option>
                            <option value="AL">Alabama</option>
                            <option value="LA">Louisiana</option>
                            <option value="KY">Kentucky</option>
                            <option value="OR">Oregon</option>
                        </select>
                    </div>
                    
                    <div class="relative">
                        <i data-lucide="bed" class="absolute left-3 top-3 w-5 h-5 text-gray-400"></i>
                        <select id="bedroomFilter" class="w-full pl-10 pr-4 py-3 bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white">
                            <option value="">Any Bedrooms</option>
                            <option value="Studio">Studio</option>
                            <option value="1 BR">1 Bedroom</option>
                            <option value="2 BR">2 Bedrooms</option>
                            <option value="3 BR">3 Bedrooms</option>
                            <option value="4 BR">4+ Bedrooms</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Quick State Links -->
            <div class="flex flex-wrap justify-center gap-3 mb-8">
                <button onclick="filterByState('CA')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-colors">California</button>
                <button onclick="filterByState('TX')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-colors">Texas</button>
                <button onclick="filterByState('FL')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-colors">Florida</button>
                <button onclick="filterByState('NY')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-colors">New York</button>
                <button onclick="filterByState('WA')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-colors">Washington</button>
                <button onclick="filterByState('CO')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 rounded-lg transition-colors">Colorado</button>
            </div>
        </div>
    </section>

    <!-- Listings Grid -->
    <section class="py-12">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold">Available Properties</h3>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-300">Showing <span id="displayCount">0</span> properties</span>
                    <button id="loadMoreBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors hidden">
                        Load More
                    </button>
                </div>
            </div>
            
            <div id="loadingSpinner" class="text-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-400 mx-auto"></div>
                <p class="mt-4 text-gray-300">Loading nationwide properties...</p>
            </div>
            
            <div id="listingsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
                <!-- Listings will be populated here -->
            </div>
            
            <div id="noResults" class="text-center py-12 hidden">
                <i data-lucide="search-x" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">No properties found</h3>
                <p class="text-gray-400">Try adjusting your search filters or expanding your search area.</p>
            </div>
        </div>
    </section>

    <!-- Chat Widget -->
    <div id="chatWidget" class="fixed bottom-4 right-4 w-96 h-96 bg-black/90 backdrop-blur-sm border border-blue-500/30 rounded-lg flex-col hidden">
        <div class="flex items-center justify-between p-4 border-b border-blue-500/30">
            <h4 class="font-semibold text-blue-300">LeaseBot AI</h4>
            <button id="closeChatBtn" class="text-gray-400 hover:text-white text-xl">×</button>
        </div>
        
        <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3">
            <div class="flex justify-start">
                <div class="max-w-xs px-3 py-2 rounded-lg bg-gray-700 text-gray-100">
                    Hey! I'm LeaseBot, your nationwide rental guide. I can filter properties by any state, city, price, or amenity! Try "show me Florida" or "find places under $2000"
                </div>
            </div>
        </div>
        
        <div class="p-4 border-t border-blue-500/30">
            <div class="flex space-x-2">
                <input
                    type="text"
                    id="chatInput"
                    placeholder="Try: show me Florida, find studios, under $2000..."
                    class="flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400"
                />
                <button id="sendChatBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">
                    Send
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black/20 backdrop-blur-sm border-t border-blue-500/30 py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h4 class="font-semibold mb-4">Popular States</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" onclick="filterByState('CA')" class="hover:text-white">California</a></li>
                        <li><a href="#" onclick="filterByState('TX')" class="hover:text-white">Texas</a></li>
                        <li><a href="#" onclick="filterByState('FL')" class="hover:text-white">Florida</a></li>
                        <li><a href="#" onclick="filterByState('NY')" class="hover:text-white">New York</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Major Cities</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="#" onclick="searchCity('Los Angeles')" class="hover:text-white">Los Angeles</a></li>
                        <li><a href="#" onclick="searchCity('New York')" class="hover:text-white">New York</a></li>
                        <li><a href="#" onclick="searchCity('Chicago')" class="hover:text-white">Chicago</a></li>
                        <li><a href="#" onclick="searchCity('Houston')" class="hover:text-white">Houston</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Features</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li>Nationwide Coverage</li>
                        <li>Real-time Updates</li>
                        <li>AI-Powered Search</li>
                        <li>Instant Messaging</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Coverage</h4>
                    <p class="text-sm text-gray-400">
                        110+ cities across all 50 US states. Updated every 6 hours with fresh listings.
                    </p>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
                <p>© 2025 LeaseBot AI Empire. Finding homes nationwide.</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let allListings = [];
        let filteredListings = [];
        let displayedListings = [];
        let currentPage = 0;
        const itemsPerPage = 12;
        let loading = false;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadListings();
            setupEventListeners();
            lucide.createIcons();
        });

        // Load listings - using robust sample data
        function loadListings() {
            console.log('Loading nationwide listings...');
            
            // Use comprehensive sample data immediately
            allListings = generateNationwideListings();
            filteredListings = [...allListings];
            updateListingCount();
            renderListings();
        }

        // Generate comprehensive nationwide sample data
        function generateNationwideListings() {
            const cities = [
                // California
                { city: 'Los Angeles', state: 'CA', avg_price: 2800, count: 8 },
                { city: 'San Francisco', state: 'CA', avg_price: 3200, count: 6 },
                { city: 'San Diego', state: 'CA', avg_price: 2400, count: 7 },
                { city: 'Sacramento', state: 'CA', avg_price: 1900, count: 5 },
                { city: 'Fresno', state: 'CA', avg_price: 1500, count: 4 },
                { city: 'Oakland', state: 'CA', avg_price: 2900, count: 6 },
                { city: 'San Jose', state: 'CA', avg_price: 3100, count: 5 },
                
                // Texas
                { city: 'Houston', state: 'TX', avg_price: 1600, count: 8 },
                { city: 'Dallas', state: 'TX', avg_price: 1800, count: 7 },
                { city: 'Austin', state: 'TX', avg_price: 2200, count: 6 },
                { city: 'San Antonio', state: 'TX', avg_price: 1400, count: 5 },
                { city: 'Fort Worth', state: 'TX', avg_price: 1700, count: 4 },
                { city: 'El Paso', state: 'TX', avg_price: 1200, count: 3 },
                
                // Florida
                { city: 'Miami', state: 'FL', avg_price: 2600, count: 8 },
                { city: 'Orlando', state: 'FL', avg_price: 1900, count: 6 },
                { city: 'Tampa', state: 'FL', avg_price: 2100, count: 7 },
                { city: 'Jacksonville', state: 'FL', avg_price: 1600, count: 5 },
                { city: 'Fort Lauderdale', state: 'FL', avg_price: 2400, count: 4 },
                { city: 'Tallahassee', state: 'FL', avg_price: 1500, count: 3 },
                
                // New York
                { city: 'New York', state: 'NY', avg_price: 3500, count: 10 },
                { city: 'Buffalo', state: 'NY', avg_price: 1200, count: 4 },
                { city: 'Rochester', state: 'NY', avg_price: 1300, count: 3 },
                { city: 'Albany', state: 'NY', avg_price: 1500, count: 4 },
                { city: 'Syracuse', state: 'NY', avg_price: 1400, count: 3 },
                
                // Illinois
                { city: 'Chicago', state: 'IL', avg_price: 2300, count: 9 },
                { city: 'Rockford', state: 'IL', avg_price: 1100, count: 3 },
                { city: 'Peoria', state: 'IL', avg_price: 1200, count: 3 },
                
                // Pennsylvania
                { city: 'Philadelphia', state: 'PA', avg_price: 1900, count: 8 },
                { city: 'Pittsburgh', state: 'PA', avg_price: 1600, count: 6 },
                { city: 'Allentown', state: 'PA', avg_price: 1400, count: 4 },
                
                // Ohio
                { city: 'Columbus', state: 'OH', avg_price: 1500, count: 6 },
                { city: 'Cleveland', state: 'OH', avg_price: 1300, count: 5 },
                { city: 'Cincinnati', state: 'OH', avg_price: 1400, count: 5 },
                
                // Georgia
                { city: 'Atlanta', state: 'GA', avg_price: 1800, count: 8 },
                { city: 'Augusta', state: 'GA', avg_price: 1300, count: 4 },
                { city: 'Savannah', state: 'GA', avg_price: 1500, count: 5 },
                
                // North Carolina
                { city: 'Charlotte', state: 'NC', avg_price: 1700, count: 7 },
                { city: 'Raleigh', state: 'NC', avg_price: 1600, count: 6 },
                { city: 'Greensboro', state: 'NC', avg_price: 1400, count: 4 },
                
                // Washington
                { city: 'Seattle', state: 'WA', avg_price: 2800, count: 8 },
                { city: 'Spokane', state: 'WA', avg_price: 1600, count: 4 },
                { city: 'Tacoma', state: 'WA', avg_price: 2200, count: 5 },
                
                // Arizona
                { city: 'Phoenix', state: 'AZ', avg_price: 1700, count: 7 },
                { city: 'Tucson', state: 'AZ', avg_price: 1400, count: 5 },
                { city: 'Mesa', state: 'AZ', avg_price: 1600, count: 4 },
                
                // Massachusetts
                { city: 'Boston', state: 'MA', avg_price: 3000, count: 8 },
                { city: 'Worcester', state: 'MA', avg_price: 2000, count: 4 },
                { city: 'Springfield', state: 'MA', avg_price: 1600, count: 3 },
                
                // Tennessee
                { city: 'Nashville', state: 'TN', avg_price: 1900, count: 7 },
                { city: 'Memphis', state: 'TN', avg_price: 1400, count: 5 },
                { city: 'Knoxville', state: 'TN', avg_price: 1300, count: 4 },
                
                // Colorado
                { city: 'Denver', state: 'CO', avg_price: 2400, count: 8 },
                { city: 'Colorado Springs', state: 'CO', avg_price: 1900, count: 5 },
                
                // Oregon
                { city: 'Portland', state: 'OR', avg_price: 2200, count: 7 },
                { city: 'Eugene', state: 'OR', avg_price: 1800, count: 4 },
                
                // Nevada
                { city: 'Las Vegas', state: 'NV', avg_price: 1800, count: 6 },
                { city: 'Reno', state: 'NV', avg_price: 1600, count: 4 },
                
                // Michigan
                { city: 'Detroit', state: 'MI', avg_price: 1200, count: 6 },
                { city: 'Grand Rapids', state: 'MI', avg_price: 1400, count: 4 },
                
                // Minnesota
                { city: 'Minneapolis', state: 'MN', avg_price: 1900, count: 7 },
                { city: 'St. Paul', state: 'MN', avg_price: 1800, count: 5 },
                
                // Additional states
                { city: 'Kansas City', state: 'MO', avg_price: 1500, count: 5 },
                { city: 'St. Louis', state: 'MO', avg_price: 1400, count: 6 },
                { city: 'Baltimore', state: 'MD', avg_price: 2000, count: 6 },
                { city: 'Milwaukee', state: 'WI', avg_price: 1600, count: 5 },
                { city: 'Indianapolis', state: 'IN', avg_price: 1300, count: 5 },
                { city: 'Louisville', state: 'KY', avg_price: 1400, count: 4 },
                { city: 'New Orleans', state: 'LA', avg_price: 1700, count: 6 },
                { city: 'Birmingham', state: 'AL', avg_price: 1200, count: 4 },
                { city: 'Charleston', state: 'SC', avg_price: 1800, count: 5 },
                { city: 'Salt Lake City', state: 'UT', avg_price: 1900, count: 5 }
            ];
            
            const descriptions = [
                'Modern apartment with stunning city views and premium amenities',
                'Spacious home in quiet neighborhood with covered parking',
                'Luxury living with resort-style pool, fitness center, and concierge',
                'Charming historic property with original hardwood floors',
                'Recently renovated unit with stainless steel appliances',
                'Pet-friendly community with dog park and grooming station',
                'Walking distance to public transit and shopping district',
                'Bright corner unit with floor-to-ceiling windows',
                'Gated community with 24/7 security and valet parking',
                'Loft-style apartment with exposed brick and high ceilings',
                'Garden-level unit with private patio and storage',
                'Penthouse with rooftop terrace and panoramic views',
                'Cozy studio perfect for young professionals',
                'Family-friendly complex with playground and picnic areas',
                'Downtown location with easy access to entertainment'
            ];
            
            const amenities = [
                'pool and fitness center',
                'in-unit laundry',
                'parking included',
                'pet-friendly',
                'balcony/patio',
                'walk-in closets',
                'dishwasher',
                'air conditioning',
                'hardwood floors',
                'fireplace'
            ];
            
            const listings = [];
            let id = 1;
            
            cities.forEach(cityData => {
                for (let i = 0; i < cityData.count; i++) {
                    const bedroomOptions = ['Studio', '1 BR', '2 BR', '3 BR'];
                    const bedrooms = bedroomOptions[Math.floor(Math.random() * bedroomOptions.length)];
                    
                    // Price variation based on bedrooms
                    let priceMultiplier = 1;
                    if (bedrooms === 'Studio') priceMultiplier = 0.7;
                    else if (bedrooms === '2 BR') priceMultiplier = 1.3;
                    else if (bedrooms === '3 BR') priceMultiplier = 1.6;
                    
                    const priceVariation = (Math.random() - 0.5) * 0.3; // ±15% variation
                    const price = Math.round(cityData.avg_price * priceMultiplier * (1 + priceVariation));
                    
                    const description = descriptions[Math.floor(Math.random() * descriptions.length)];
                    const amenity = amenities[Math.floor(Math.random() * amenities.length)];
                    
                    listings.push({
                        id: id++,
                        city: cityData.city,
                        state: cityData.state,
                        price: `$${price.toLocaleString()}/mo`,
                        priceValue: price, // For filtering
                        bedrooms: bedrooms,
                        description: `${description}. Features ${amenity}.`,
                        amenities: amenity,
                        link: `https://example.com/listing${id}`,
                        image: `https://picsum.photos/400/300?random=${id}`,
                        source: 'demo'
                    });
                }
            });
            
            console.log(`Generated ${listings.length} nationwide listings`);
            return listings;
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', debounce(filterListings, 300));
            document.getElementById('stateFilter').addEventListener('change', filterListings);
            document.getElementById('bedroomFilter').addEventListener('change', filterListings);
            document.getElementById('loadMoreBtn').addEventListener('click', loadMoreListings);
            
            // Chat functionality
            document.getElementById('chatBtn').addEventListener('click', () => {
                document.getElementById('chatWidget').classList.remove('hidden');
                document.getElementById('chatWidget').classList.add('flex');
            });
            
            document.getElementById('closeChatBtn').addEventListener('click', () => {
                document.getElementById('chatWidget').classList.add('hidden');
                document.getElementById('chatWidget').classList.remove('flex');
            });
            
            document.getElementById('sendChatBtn').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
        }

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Enhanced filter function
        function filterListings() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const stateFilter = document.getElementById('stateFilter').value;
            const bedroomFilter = document.getElementById('bedroomFilter').value;
            
            filteredListings = allListings.filter(listing => {
                const matchesSearch = !searchTerm || 
                    listing.city.toLowerCase().includes(searchTerm) ||
                    listing.state.toLowerCase().includes(searchTerm) ||
                    listing.description.toLowerCase().includes(searchTerm) ||
                    listing.amenities.toLowerCase().includes(searchTerm);
                
                const matchesState = !stateFilter || listing.state === stateFilter;
                const matchesBedrooms = !bedroomFilter || listing.bedrooms === bedroomFilter;
                
                return matchesSearch && matchesState && matchesBedrooms;
            });
            
            currentPage = 0;
            displayedListings = [];
            updateListingCount();
            renderListings();
        }

        // Filter by price range
        function filterByPrice(minPrice, maxPrice) {
            filteredListings = allListings.filter(listing => {
                const price = listing.priceValue;
                return price >= minPrice && price <= maxPrice;
            });
            
            currentPage = 0;
            displayedListings = [];
            updateListingCount();
            renderListings();
        }

        // Filter by state (for quick links)
        function filterByState(state) {
            document.getElementById('stateFilter').value = state;
            filterListings();
        }

        // Search by city
        function searchCity(city) {
            document.getElementById('searchInput').value = city;
            filterListings();
        }

        // Update listing count
        function updateListingCount() {
            document.getElementById('listingCount').textContent = allListings.length.toLocaleString();
            document.getElementById('displayCount').textContent = filteredListings.length.toLocaleString();
        }

        // Render listings
        function renderListings() {
            const grid = document.getElementById('listingsGrid');
            const spinner = document.getElementById('loadingSpinner');
            const noResults = document.getElementById('noResults');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            
            if (loading) return;
            
            // Show/hide appropriate elements
            if (filteredListings.length === 0) {
                grid.classList.add('hidden');
                spinner.classList.add('hidden');
                noResults.classList.remove('hidden');
                loadMoreBtn.classList.add('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            grid.classList.remove('hidden');
            spinner.classList.add('hidden');
            
            // Load more listings
            const startIndex = displayedListings.length;
            const endIndex = startIndex + itemsPerPage;
            const newListings = filteredListings.slice(startIndex, endIndex);
            
            displayedListings.push(...newListings);
            
            // Clear grid if this is the first load
            if (currentPage === 0) {
                grid.innerHTML = '';
            }
            
            // Add new listings
            newListings.forEach(listing => {
                const listingCard = createListingCard(listing);
                grid.appendChild(listingCard);
            });
            
            // Show/hide load more button
            if (displayedListings.length < filteredListings.length) {
                loadMoreBtn.classList.remove('hidden');
            } else {
                loadMoreBtn.classList.add('hidden');
            }
            
            currentPage++;
            lucide.createIcons();
        }

        // Create listing card
        function createListingCard(listing) {
            const card = document.createElement('div');
            card.className = 'bg-white/10 backdrop-blur-sm border border-white/20 rounded-lg overflow-hidden hover:scale-105 transition-transform duration-300';
            
            card.innerHTML = `
                <div class="aspect-video bg-gradient-to-br from-blue-500/20 to-purple-500/20 flex items-center justify-center">
                    <img 
                        src="${listing.image}" 
                        alt="${listing.city} rental"
                        class="w-full h-full object-cover"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                    />
                    <div class="hidden w-full h-full items-center justify-center text-gray-400">
                        <i data-lucide="map-pin" class="w-8 h-8"></i>
                    </div>
                </div>
                
                <div class="p-6">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-lg font-semibold text-blue-300">${listing.city}, ${listing.state}</h4>
                        <span class="text-2xl font-bold text-green-400">${listing.price}</span>
                    </div>
                    
                    <div class="flex items-center space-x-4 mb-3 text-gray-300">
                        <div class="flex items-center space-x-1">
                            <i data-lucide="bed" class="w-4 h-4"></i>
                            <span>${listing.bedrooms}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i data-lucide="map-pin" class="w-4 h-4"></i>
                            <span>${listing.state}</span>
                        </div>
                    </div>
                    
                    <p class="text-gray-300 mb-4 line-clamp-3">${listing.description}</p>
                    
                    <div class="flex space-x-2">
                        <button 
                            onclick="handleInquiry(${listing.id})"
                            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors font-medium"
                        >
                            Inquire
                        </button>
                        <button class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-colors font-medium flex items-center justify-center space-x-2">
                            <i data-lucide="calendar" class="w-4 h-4"></i>
                            <span>Book Tour</span>
                        </button>
                        <button class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors font-medium">
                            Apply Now
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Load more listings
        function loadMoreListings() {
            renderListings();
        }

        // Handle inquiry
        function handleInquiry(listingId) {
            const listing = allListings.find(l => l.id === listingId);
            if (!listing) return;
            
            document.getElementById('chatWidget').classList.remove('hidden');
            document.getElementById('chatWidget').classList.add('flex');
            
            addChatMessage('user', `I'm interested in the ${listing.bedrooms} in ${listing.city}, ${listing.state} for ${listing.price}`);
            setTimeout(() => {
                addChatMessage('bot', `Excellent choice! This ${listing.city} property is in a great location. ${listing.description} Would you like to schedule a tour or learn more about the neighborhood?`);
            }, 1000);
        }

        // Chat functions
        function addChatMessage(type, text) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${type === 'user' ? 'justify-end' : 'justify-start'}`;
            messageDiv.innerHTML = `
                <div class="max-w-xs px-3 py-2 rounded-lg ${
                    type === 'user' 
                        ? 'bg-blue-600 text-white' 
                        : 'bg-gray-700 text-gray-100'
                }">
                    ${text}
                </div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage('user', message);
            input.value = '';

            setTimeout(() => {
                const response = generateNationwideResponse(message);
                addChatMessage('bot', response);
            }, 1000);
        }

        // ENHANCED SMART CHAT with ALL filtering capabilities
        function generateNationwideResponse(message) {
            const msg = message.toLowerCase();
            
            // ACTION-BASED RESPONSES - Actually do things!
            if (msg.includes('show me') || msg.includes('filter') || msg.includes('find') || msg.includes('search')) {
                
                // PRICE FILTERING
                if (msg.includes('under') || msg.includes('below') || msg.includes('less than')) {
                    const priceMatch = msg.match(/(\d+)/);
                    if (priceMatch) {
                        const maxPrice = parseInt(priceMatch[1]);
                        filterByPrice(0, maxPrice);
                        return `Perfect! I've filtered to show properties under $${maxPrice.toLocaleString()}. Found ${filteredListings.length} affordable options above!`;
                    }
                }
                
                if (msg.includes('over') || msg.includes('above') || msg.includes('more than')) {
                    const priceMatch = msg.match(/(\d+)/);
                    if (priceMatch) {
                        const minPrice = parseInt(priceMatch[1]);
                        filterByPrice(minPrice, 10000);
                        return `Great! Showing properties over $${minPrice.toLocaleString()}. Found ${filteredListings.length} premium options above!`;
                    }
                }
                
                // PRICE RANGE FILTERING
                if (msg.includes('between') && msg.includes('and')) {
                    const priceMatch = msg.match(/(\d+).*?(\d+)/);
                    if (priceMatch) {
                        const minPrice = parseInt(priceMatch[1]);
                        const maxPrice = parseInt(priceMatch[2]);
                        filterByPrice(minPrice, maxPrice);
                        return `Perfect! Filtered to show properties between $${minPrice.toLocaleString()} and $${maxPrice.toLocaleString()}. Found ${filteredListings.length} options in your budget!`;
                    }
                }
                
                // STATE FILTERING
                if (msg.includes('florida') || msg.includes('fl')) {
                    filterByState('FL');
                    return `Perfect! I've filtered to show Florida properties only. You can see all ${allListings.filter(l => l.state === 'FL').length} Florida listings above, from Miami's beaches to Orlando's theme parks!`;
                }
                if (msg.includes('california') || msg.includes('ca')) {
                    filterByState('CA');
                    return `Awesome! Now showing California properties only. ${allListings.filter(l => l.state === 'CA').length} listings from LA to San Francisco are displayed above!`;
                }
                if (msg.includes('texas') || msg.includes('tx')) {
                    filterByState('TX');
                    return `Great choice! Filtered to show Texas properties. ${allListings.filter(l => l.state === 'TX').length} listings across Houston, Dallas, Austin, and more are now visible!`;
                }
                if (msg.includes('new york') || msg.includes('ny')) {
                    filterByState('NY');
                    return `Excellent! Now showing New York properties. ${allListings.filter(l => l.state === 'NY').length} listings from NYC to upstate are displayed above!`;
                }
                if (msg.includes('washington') || msg.includes('wa')) {
                    filterByState('WA');
                    return `Perfect! Filtered to show Washington state properties. ${allListings.filter(l => l.state === 'WA').length} listings from Seattle to Spokane are above!`;
                }
                if (msg.includes('colorado') || msg.includes('co')) {
                    filterByState('CO');
                    return `Great! Now showing Colorado properties. ${allListings.filter(l => l.state === 'CO').length} listings with mountain views and outdoor access!`;
                }
                
                // CITY FILTERING
                const cityListings = allListings.filter(l => 
                    l.city.toLowerCase().includes(msg) || 
                    msg.includes(l.city.toLowerCase())
                );
                
                if (cityListings.length > 0) {
                    const city = cityListings[0].city;
                    document.getElementById('searchInput').value = city;
                    filterListings();
                    return `Perfect! I've filtered to show ${cityListings.length} listings in ${city}. You can see them all above!`;
                }
                
                // BEDROOM FILTERING
                if (msg.includes('studio')) {
                    document.getElementById('bedroomFilter').value = 'Studio';
                    filterListings();
                    return `Great! Now showing studio apartments only. Check out the ${filteredListings.length} studio options above!`;
                }
                if (msg.includes('1 bed') || msg.includes('1br') || msg.includes('1 br')) {
                    document.getElementById('bedroomFilter').value = '1 BR';
                    filterListings();
                    return `Perfect! Filtered to show 1-bedroom properties. All ${filteredListings.length} options are displayed above!`;
                }
                if (msg.includes('2 bed') || msg.includes('2br') || msg.includes('2 br')) {
                    document.getElementById('bedroomFilter').value = '2 BR';
                    filterListings();
                    return `Excellent! Now showing 2-bedroom properties only. Browse the ${filteredListings.length} results above!`;
                }
                if (msg.includes('3 bed') || msg.includes('3br') || msg.includes('3 br')) {
                    document.getElementById('bedroomFilter').value = '3 BR';
                    filterListings();
                    return `Great! Filtered to show 3-bedroom properties. Found ${filteredListings.length} spacious options above!`;
                }
                
                // AMENITY FILTERING
                if (msg.includes('pool') || msg.includes('fitness') || msg.includes('gym')) {
                    document.getElementById('searchInput').value = 'pool fitness';
                    filterListings();
                    return `Perfect! Filtered to show properties with pools and fitness centers. Found ${filteredListings.length} luxury options above!`;
                }
                if (msg.includes('parking') || msg.includes('garage')) {
                    document.getElementById('searchInput').value = 'parking';
                    filterListings();
                    return `Great! Now showing properties with parking included. Found ${filteredListings.length} convenient options above!`;
                }
                if (msg.includes('pet') || msg.includes('dog') || msg.includes('cat')) {
                    document.getElementById('searchInput').value = 'pet-friendly';
                    filterListings();
                    return `Awesome! Filtered to show pet-friendly properties. Found ${filteredListings.length} pet-welcoming homes above!`;
                }
                if (msg.includes('balcony') || msg.includes('patio') || msg.includes('outdoor')) {
                    document.getElementById('searchInput').value = 'balcony patio';
                    filterListings();
                    return `Perfect! Showing properties with outdoor spaces. Found ${filteredListings.length} options with balconies/patios above!`;
                }
                
                return `I've searched for "${message}" - check the ${filteredListings.length} results above! You can also use the filters to narrow down your search.`;
            }
            
            // Reset filters
            if (msg.includes('reset') || msg.includes('clear') || msg.includes('all') || msg.includes('show all')) {
                document.getElementById('searchInput').value = '';
                document.getElementById('stateFilter').value = '';
                document.getElementById('bedroomFilter').value = '';
                filterListings();
                return `Reset! Now showing all ${allListings.length} properties nationwide. You can see everything above!`;
            }
            
            // State-specific responses (when not asking to show)
            const stateResponses = {
                'california': () => {
                    const caListings = allListings.filter(l => l.state === 'CA');
                    return `California is amazing! I have ${caListings.length} listings across LA, San Francisco, San Diego, and more. Prices range from $1,500 in Fresno to $3,200 in SF. Say "show me California" to see them all!`;
                },
                'texas': () => {
                    const txListings = allListings.filter(l => l.state === 'TX');
                    return `Texas has incredible value! I have ${txListings.length} listings in Houston, Dallas, Austin, and San Antonio. No state income tax and great BBQ! Prices start around $1,200. Say "show me Texas" to filter!`;
                },
                'florida': () => {
                    const flListings = allListings.filter(l => l.state === 'FL');
                    return `Florida living at its finest! I have ${flListings.length} listings from Miami's beaches to Orlando's theme parks. Year-round sunshine and no state income tax. Prices range from $1,500-$2,600. Say "show me Florida" to see them all!`;
                },
                'new york': () => {
                    const nyListings = allListings.filter(l => l.state === 'NY');
                    return `The Empire State! I have ${nyListings.length} listings from NYC's energy to Buffalo's charm. NYC starts around $3,500 while upstate cities are much more affordable. Say "show me New York" to filter!`;
                }
            };
            
            // Check for state mentions
            for (const [state, response] of Object.entries(stateResponses)) {
                if (msg.includes(state)) {
                    return response();
                }
            }
            
            // City-specific responses
            const cityListings = allListings.filter(l => 
                l.city.toLowerCase().includes(msg) || 
                msg.includes(l.city.toLowerCase())
            );
            
            if (cityListings.length > 0) {
                const city = cityListings[0];
                const avgPrice = cityListings.reduce((sum, listing) => {
                    const price = parseInt(listing.price.replace(/[^0-9]/g, ''));
                    return sum + price;
                }, 0) / cityListings.length;
                
                return `Great choice! I have ${cityListings.length} listings in ${city.city}, ${city.state}. Average price is around $${Math.round(avgPrice).toLocaleString()}/mo. This city offers ${getCityHighlight(city.city)}. Say "show me ${city.city}" to see all listings!`;
            }
            
            // Budget responses
            if (msg.includes('budget') || msg.includes('price') || msg.includes('$')) {
                return `I can help you find great value nationwide! Try: "show me under $1500" for budget options, "show me between $1500 and $2500" for mid-range, or "show me over $2500" for luxury properties. What's your budget range?`;
            }
            
            // General responses
            const responses = [
                `I cover all 50 states with ${allListings.length} listings! Say "show me [state]" to filter by state, "show me under $2000" for budget, or "show me 2 bedroom" for specific needs.`,
                `From coast to coast, I can find your perfect home. Try "show me California", "find studios", or "show me places with pools" to filter the results above!`,
                `Nationwide search at your fingertips! Say "show me Florida", "under $1800", or "pet-friendly" and I'll filter the listings above for you.`,
                `I have listings everywhere! Try commands like "show me Texas", "find 2 bedroom under $2000", or "show me places with parking" to filter results.`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function getCityHighlight(city) {
            const highlights = {
                'Los Angeles': 'entertainment industry and year-round perfect weather',
                'San Francisco': 'tech innovation and iconic landmarks',
                'New York': 'world-class dining and endless career opportunities',
                'Chicago': 'stunning architecture and incredible food scene',
                'Houston': 'energy sector jobs and cultural diversity',
                'Miami': 'beautiful beaches and vibrant nightlife',
                'Austin': 'live music scene and booming tech industry',
                'Denver': 'outdoor recreation and craft beer culture',
                'Seattle': 'coffee culture and tech innovation',
                'Phoenix': 'year-round sunshine and affordable living',
                'Atlanta': 'business opportunities and southern charm',
                'Boston': 'rich history and world-class universities',
                'Las Vegas': 'entertainment and surprisingly affordable living',
                'Portland': 'foodie culture and outdoor access',
                'Nashville': 'music scene and growing job market'
            };
            
            return highlights[city] || 'unique character and great opportunities';
        }
    </script>
</body>
</html>
